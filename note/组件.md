# 组件

- [组件的作用和含义](#1-组件的作用和含义)
- [组件的注册方法](#2-组件注册)
- [props](#3-props)
- [非 Prop 的 Attribute](#4-非-Prop-的-Attribute)
- [为何 data 是函数](#5-为何-data-是函数)


# 1. 组件的作用和含义
每一个 `Vue` 应用都是通过 `createApp()` 方法创建一个新的「应用实例」，通过应用实例来注册「全局组件」。

```js
const app = Vue.createApp({})
```

「组件」就是可以复用的 `vue` 实例，可以在其他 `vue` 实例中使用。

传递给 `createApp()` 的选项用于配置「根组件」，在挂载时作为渲染的起点。

![组件](https://cn.vuejs.org/images/components.png)

通常一个应用会以一棵嵌套的「组件树」的形式来组织。例如一个页面包含了页头，页尾，侧边栏，那么这三个部分可以看作是三个组件，而整个页面是有这三个页面组装实现的。



# 2. 组件注册
为了能在模板中使用，这些组件必须先注册以便 Vue 能够识别。

## 2.1. 全局注册
「全局注册」的组件可以用在其被注册之后的任何 (通过 new Vue) 新创建的 Vue 根实例，也包括其组件树中的所有子组件的模板中。
```js
Vue.component('button-counter', {
  data: function() {
    return: {
      count: 0
    }
  }
  template: `
    <button @click="count++">
      {{count}}
    </button>
  `
})
```
```html
<div>
  <button-counter></button-counter>
</div>
```


## 2.2. 局部注册
「全局注册」的组件意味着即使组件不在使用了，仍然会构建在最终结果中。可以通过一个普通的 JavaScript 对象来定义组件。

```js
const app = Vue.createApp({
  components: {
    'component-a': ComponentA,
    'component-b': ComponentB,
  }
})
```


# 3. props 
`props` 用于「父组件」向「子组件」传值，是单项数据流，以防止子组件更改父组件的状态。当父组件更新时，子组件中所有的 `props` 都会同步更新。

以字符串的方式：
```js
props: ['a', 'b'];
data() {
  return {
    a: this.a
  }
}
```

指定类型：
```js
props: {
  a: String,
  b: Number,
}
data() {
  return {
    a: this.a
  }
}
```

为组件的 `props` 指定验证方式，为 props 中的值提供一个带有验证要求的对象，如果有一个要求没有被满足，则 Vue 会在浏览器控制台中警告你。

```js
props: {
  b: [String, Number],

  c: {
    type: String,
    required: true
  },

  d: {
    type: Number,
    default: 100
  },

  e: {
    type: Object,
    default() {
      return {message: 'hello world'}
    }
  },

  f: {
    validator(value) {
      return ['a', 'b', 'c'].includes(value);
    }
  }

  g: {
    type: Function,
    default() {
      return 'Default Function';
    }
  }
}
```


# 4. 非 Prop 的 Attribute
在组件中没有相应的 `props` 或者是 `emits` 定义的 attribute，常见的示例包括了 `class` 、`style`、`id` 等属性。可以通过 `$attrs` 属性来访问这些属性。

```js
app.component('date-picker', {
  template: `
    <div class="data-picker">
      <input type="dataliner-lock" />
    </div>
  `
})
```

```html
<date-picker data-status="activated"></date-picker>
```

渲染后的 `date-picker` 组件。
```html
<div class="date-picker" data-status="activated">
  <input type="datetime-local" />
</div>
```

事件监听器从「父组件」传递到「子组件」。
```js
app.component('date-picker', {
  template: `
    <select>
      <option value="1">Yesterday</option>
      <option value="2">Today</option>
      <option value="3">Tomorrow</option>
    </select>
  `
})
```

```html
<div id="date-picker" class="demo">
  <date-picker @change="showChange"></date-picker>
</div>
```

```js
const app = Vue.createApp({
  methods: {
    showChange(event) {
      console.log(event.target.value);
    }
  }
})
```


# 5. 为何 data 是函数
在 `vue2` 的「选项式 API」模式下，组件的 `data` 选项必须为函数，这样每个实例可以维护一份被返回对象的独立的拷贝。在组件复用时，不会出现数据相互干扰的情况。